<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SwipeSavvy Deployment Guide</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f6f6f6 0%, #f0f0f0 100%);
            color: #132136;
            line-height: 1.6;
        }

        header {
            background: linear-gradient(135deg, #60BA46 0%, #4a8e34 100%);
            color: white;
            padding: 40px 20px;
            text-align: center;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .nav-link {
            display: inline-block;
            background: rgba(0, 0, 0, 0.2);
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            text-decoration: none;
            margin: 5px;
            font-size: 0.9em;
            transition: background 0.3s;
        }

        .nav-link:hover {
            background: rgba(0, 0, 0, 0.3);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        section {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        h2 {
            color: #60BA46;
            font-size: 1.8em;
            margin-bottom: 20px;
            border-bottom: 3px solid #60BA46;
            padding-bottom: 15px;
        }

        h3 {
            color: #235393;
            font-size: 1.3em;
            margin: 25px 0 15px 0;
        }

        h4 {
            color: #235393;
            margin: 15px 0 10px 0;
        }

        .step {
            background: #f0f8ff;
            border-left: 4px solid #60BA46;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }

        .step-number {
            display: inline-block;
            background: #60BA46;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            text-align: center;
            line-height: 30px;
            font-weight: bold;
            margin-right: 10px;
        }

        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            display: block;
            margin: 10px 0;
            padding: 10px;
            overflow-x: auto;
        }

        .checklist {
            list-style: none;
            padding-left: 0;
        }

        .checklist li {
            padding: 8px 0;
            padding-left: 25px;
            position: relative;
        }

        .checklist li:before {
            content: "‚òê";
            position: absolute;
            left: 0;
            font-size: 1.2em;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        th {
            background: #60BA46;
            color: white;
            padding: 12px;
            text-align: left;
        }

        td {
            padding: 12px;
            border-bottom: 1px solid #ddd;
        }

        tr:nth-child(even) {
            background: #f9f9f9;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            background: white;
        }

        .card h4 {
            margin-top: 0;
        }

        footer {
            background: #132136;
            color: white;
            text-align: center;
            padding: 20px;
            margin-top: 40px;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>üöÄ Deployment Guide</h1>
        <p>Complete deployment procedures, checklists, and operations</p>
        <nav style="margin-top: 20px;">
            <a href="SYSTEM_SNAPSHOT_INDEX.html" class="nav-link">‚Üê Back to Index</a>
            <a href="SYSTEM_SNAPSHOT_QUICK_REFERENCE.html" class="nav-link">‚Üê Quick Reference</a>
            <a href="SYSTEM_SNAPSHOT_ROADMAP.html" class="nav-link">Roadmap ‚Üí</a>
        </nav>
    </header>

    <div class="container">
        <!-- Pre-Deployment -->
        <section>
            <h2>üìã Pre-Deployment Checklist</h2>

            <h3>Code Quality & Testing</h3>
            <ul class="checklist">
                <li>All unit tests passing (<code>npm test</code> / <code>pytest tests/</code>)</li>
                <li>No TypeScript errors (<code>tsc --noEmit</code>)</li>
                <li>No linting issues (<code>npm run lint</code>)</li>
                <li>Code coverage >= 80%</li>
                <li>Security audit passes (<code>npm audit</code>)</li>
                <li>SonarQube quality gate passed</li>
            </ul>

            <h3>Infrastructure & Configuration</h3>
            <ul class="checklist">
                <li>Environment variables configured in target environment</li>
                <li>Database backups created and verified</li>
                <li>SSL certificates valid and renewed</li>
                <li>DNS records pointing to correct endpoints</li>
                <li>CDN cache clear scheduled</li>
                <li>Monitoring and alerts configured</li>
            </ul>

            <h3>Documentation & Communication</h3>
            <ul class="checklist">
                <li>Release notes written and reviewed</li>
                <li>Deployment runbook prepared</li>
                <li>Team notified of deployment window</li>
                <li>Customer communication prepared</li>
                <li>Rollback plan documented and tested</li>
                <li>On-call engineer assigned</li>
            </ul>
        </section>

        <!-- Staging Deployment -->
        <section>
            <h2>üì¶ Staging Deployment</h2>

            <h3>Step-by-Step Deployment</h3>

            <div class="step">
                <span class="step-number">1</span>
                <strong>Build Docker Images</strong>
                <code>
cd swipesavvy-ai-agents
docker build -t swipesavvy-api:staging .</code>
            </div>

            <div class="step">
                <span class="step-number">2</span>
                <strong>Push to Registry</strong>
                <code>
docker tag swipesavvy-api:staging 123456789.dkr.ecr.us-east-1.amazonaws.com/swipesavvy-api:staging
docker push 123456789.dkr.ecr.us-east-1.amazonaws.com/swipesavvy-api:staging</code>
            </div>

            <div class="step">
                <span class="step-number">3</span>
                <strong>Deploy to ECS/Kubernetes</strong>
                <code>
kubectl set image deployment/swipesavvy-api \
  swipesavvy-api=123456789.dkr.ecr.us-east-1.amazonaws.com/swipesavvy-api:staging \
  --namespace staging</code>
            </div>

            <div class="step">
                <span class="step-number">4</span>
                <strong>Run Database Migrations</strong>
                <code>
kubectl exec -it deployment/swipesavvy-api -n staging -- \
  alembic upgrade head</code>
            </div>

            <div class="step">
                <span class="step-number">5</span>
                <strong>Verify Deployment</strong>
                <code>
curl https://staging-api.swipesavvy.com/health
# Expected: {"status": "healthy", "version": "1.2.0"}</code>
            </div>

            <div class="step">
                <span class="step-number">6</span>
                <strong>Run Smoke Tests</strong>
                <code>
npm run test:smoke -- --env=staging</code>
            </div>

            <div class="step">
                <span class="step-number">7</span>
                <strong>Sanity Check</strong>
                <ul>
                    <li>Login with test user</li>
                    <li>Create test campaign</li>
                    <li>Test chat with AI concierge</li>
                    <li>Verify rewards calculation</li>
                </ul>
            </div>
        </section>

        <!-- Production Deployment -->
        <section>
            <h2>üî¥ Production Deployment (Blue-Green Strategy)</h2>

            <h3>Blue-Green Deployment Overview</h3>
            <p><strong>Strategy:</strong> Run two identical production environments. Switch traffic between them during deployment to minimize downtime.</p>

            <h3>Phase 1: Prepare Green Environment</h3>
            <div class="step">
                <span class="step-number">1</span>
                <strong>Build & Push Image</strong>
                <code>
docker build -t swipesavvy-api:1.2.0 .
docker push 123456789.dkr.ecr.us-east-1.amazonaws.com/swipesavvy-api:1.2.0</code>
            </div>

            <div class="step">
                <span class="step-number">2</span>
                <strong>Deploy to Green Environment</strong>
                <code>
kubectl apply -f k8s/production-green.yaml</code>
            </div>

            <div class="step">
                <span class="step-number">3</span>
                <strong>Run Migrations on Green</strong>
                <code>
kubectl exec -it deployment/swipesavvy-api-green -- alembic upgrade head</code>
            </div>

            <div class="step">
                <span class="step-number">4</span>
                <strong>Comprehensive Testing</strong>
                <ul>
                    <li>Full regression test suite</li>
                    <li>Load testing (5,000+ concurrent users)</li>
                    <li>API contract testing</li>
                    <li>Database integrity checks</li>
                </ul>
            </div>

            <h3>Phase 2: Switch Traffic</h3>
            <div class="step">
                <span class="step-number">5</span>
                <strong>Update Load Balancer</strong>
                <code>
kubectl patch service swipesavvy-api -p \
  '{"spec":{"selector":{"app":"swipesavvy-api-green"}}}'</code>
            </div>

            <div class="step">
                <span class="step-number">6</span>
                <strong>Monitor Metrics (30 minutes)</strong>
                <ul>
                    <li>Error rate < 0.1%</li>
                    <li>Latency < 200ms (p95)</li>
                    <li>CPU < 60%</li>
                    <li>Memory < 70%</li>
                </ul>
            </div>

            <h3>Phase 3: Cleanup</h3>
            <div class="step">
                <span class="step-number">7</span>
                <strong>Scale Down Blue Environment</strong>
                <code>
kubectl scale deployment swipesavvy-api-blue --replicas=0 -n production</code>
            </div>

            <div class="step">
                <span class="step-number">8</span>
                <strong>Document Deployment</strong>
                <code>
Record in change log:
- Start time: 2026-01-01 14:00 UTC
- End time: 2026-01-01 14:30 UTC
- Metrics: ‚úÖ All nominal
- No incidents</code>
            </div>
        </section>

        <!-- Rollback Procedures -->
        <section>
            <h2>‚ö†Ô∏è Rollback Procedures</h2>

            <h3>When to Rollback</h3>
            <table>
                <tr>
                    <th>Condition</th>
                    <th>Action</th>
                    <th>Timeline</th>
                </tr>
                <tr>
                    <td>Error rate > 1%</td>
                    <td>Immediate rollback</td>
                    <td>< 5 minutes</td>
                </tr>
                <tr style="background: #f9f9f9;">
                    <td>API response > 500ms</td>
                    <td>Investigate, rollback if unresolved</td>
                    <td>< 10 minutes</td>
                </tr>
                <tr>
                    <td>Database query failures</td>
                    <td>Immediate rollback</td>
                    <td>< 5 minutes</td>
                </tr>
                <tr style="background: #f9f9f9;">
                    <td>Data corruption detected</td>
                    <td>Rollback + restore backup</td>
                    <td>< 30 minutes</td>
                </tr>
            </table>

            <h3>Rollback Steps</h3>
            <div class="step">
                <span class="step-number">1</span>
                <strong>Switch Traffic Back to Blue</strong>
                <code>
kubectl patch service swipesavvy-api -p \
  '{"spec":{"selector":{"app":"swipesavvy-api-blue"}}}'</code>
            </div>

            <div class="step">
                <span class="step-number">2</span>
                <strong>Monitor for 5 Minutes</strong>
                <p>Verify error rates return to normal</p>
            </div>

            <div class="step">
                <span class="step-number">3</span>
                <strong>If Data Corruption, Restore Backup</strong>
                <code>
aws s3 cp s3://swipesavvy-backups/db-backup-2026-01-01.sql .
psql -U postgres -d swipesavvy < db-backup-2026-01-01.sql</code>
            </div>

            <div class="step">
                <span class="step-number">4</span>
                <strong>Post-Incident Review</strong>
                <ul>
                    <li>What went wrong?</li>
                    <li>How do we prevent it?</li>
                    <li>Implement safeguards</li>
                </ul>
            </div>
        </section>

        <!-- Scaling & Operations -->
        <section>
            <h2>üìà Scaling & Operations</h2>

            <h3>Horizontal Scaling (Adding Replicas)</h3>
            <div class="step">
                <span class="step-number">1</span>
                <strong>Check Current Load</strong>
                <code>
kubectl get hpa swipesavvy-api -n production
# Check CPU utilization and replica count</code>
            </div>

            <div class="step">
                <span class="step-number">2</span>
                <strong>Update Auto-Scaling Policy</strong>
                <code>
kubectl autoscale deployment swipesavvy-api \
  --min=3 --max=15 --cpu-percent=70 \
  -n production</code>
            </div>

            <h3>Vertical Scaling (More Resources per Pod)</h3>
            <div class="step">
                <span class="step-number">1</span>
                <strong>Update Resource Requests</strong>
                <code>
resources:
  requests:
    memory: "512Mi"
    cpu: "250m"
  limits:
    memory: "1Gi"
    cpu: "500m"</code>
            </div>

            <h3>Database Scaling</h3>
            <table>
                <tr>
                    <th>Metric</th>
                    <th>Healthy</th>
                    <th>Caution</th>
                    <th>Action Needed</th>
                </tr>
                <tr>
                    <td>CPU Utilization</td>
                    <td>&lt; 30%</td>
                    <td>30-60%</td>
                    <td>&gt; 60%</td>
                </tr>
                <tr style="background: #f9f9f9;">
                    <td>Memory Usage</td>
                    <td>&lt; 40%</td>
                    <td>40-70%</td>
                    <td>&gt; 70%</td>
                </tr>
                <tr>
                    <td>Disk Usage</td>
                    <td>&lt; 50%</td>
                    <td>50-80%</td>
                    <td>&gt; 80%</td>
                </tr>
                <tr style="background: #f9f9f9;">
                    <td>Connections</td>
                    <td>&lt; 50%</td>
                    <td>50-80%</td>
                    <td>&gt; 80%</td>
                </tr>
            </table>
        </section>

        <!-- Monitoring & Alerts -->
        <section>
            <h2>üìä Monitoring & Alerts</h2>

            <h3>Key Metrics to Monitor</h3>
            <div class="grid">
                <div class="card">
                    <h4>Application Metrics</h4>
                    <ul>
                        <li>Request rate (req/sec)</li>
                        <li>Error rate (errors/sec)</li>
                        <li>Response latency (p50, p95, p99)</li>
                        <li>Throughput (transactions/sec)</li>
                    </ul>
                </div>

                <div class="card">
                    <h4>Infrastructure Metrics</h4>
                    <ul>
                        <li>CPU utilization (%)</li>
                        <li>Memory usage (MB)</li>
                        <li>Disk I/O (MB/sec)</li>
                        <li>Network bandwidth (MB/sec)</li>
                    </ul>
                </div>

                <div class="card">
                    <h4>Database Metrics</h4>
                    <ul>
                        <li>Query execution time</li>
                        <li>Slow query log</li>
                        <li>Connection pool usage</li>
                        <li>Table/index sizes</li>
                    </ul>
                </div>

                <div class="card">
                    <h4>Business Metrics</h4>
                    <ul>
                        <li>Campaign delivery rate</li>
                        <li>Conversion rate</li>
                        <li>User login success %</li>
                        <li>Rewards points distributed</li>
                    </ul>
                </div>
            </div>

            <h3>Alert Thresholds</h3>
            <table>
                <tr>
                    <th>Metric</th>
                    <th>Warning</th>
                    <th>Critical</th>
                </tr>
                <tr>
                    <td>Error Rate</td>
                    <td>0.5%</td>
                    <td>1.0%</td>
                </tr>
                <tr style="background: #f9f9f9;">
                    <td>Response Latency (p95)</td>
                    <td>300ms</td>
                    <td>500ms</td>
                </tr>
                <tr>
                    <td>CPU Utilization</td>
                    <td>70%</td>
                    <td>85%</td>
                </tr>
                <tr style="background: #f9f9f9;">
                    <td>Memory Usage</td>
                    <td>75%</td>
                    <td>90%</td>
                </tr>
                <tr>
                    <td>Disk Usage</td>
                    <td>80%</td>
                    <td>95%</td>
                </tr>
            </table>
        </section>

        <!-- Maintenance Windows -->
        <section>
            <h2>üîß Maintenance & Patching</h2>

            <h3>Scheduled Maintenance Windows</h3>
            <table>
                <tr>
                    <th>Maintenance Type</th>
                    <th>Frequency</th>
                    <th>Duration</th>
                    <th>Impact</th>
                </tr>
                <tr>
                    <td>Security patches</td>
                    <td>As needed</td>
                    <td>30-60 min</td>
                    <td>Rolling deployment</td>
                </tr>
                <tr style="background: #f9f9f9;">
                    <td>Database cleanup (VACUUM)</td>
                    <td>Weekly (Sunday 2 AM)</td>
                    <td>30 min</td>
                    <td>Performance optimized</td>
                </tr>
                <tr>
                    <td>Backup verification</td>
                    <td>Daily (3 AM)</td>
                    <td>15 min</td>
                    <td>No user impact</td>
                </tr>
                <tr style="background: #f9f9f9;">
                    <td>OS/Kernel updates</td>
                    <td>Monthly 2nd Tuesday</td>
                    <td>2 hours</td>
                    <td>Blue-green deployment</td>
                </tr>
            </table>

            <h3>Zero-Downtime Deployment Steps</h3>
            <ol>
                <li>Deploy new version to canary environment (5% traffic)</li>
                <li>Monitor for 15 minutes</li>
                <li>Gradually increase traffic to 25%, 50%, 100%</li>
                <li>If issues, rollback to previous version</li>
                <li>Otherwise, mark as stable</li>
            </ol>
        </section>
    </div>

    <footer>
        <div style="max-width: 1200px; margin: 0 auto; padding: 20px;">
            <p><strong>SwipeSavvy Deployment Guide</strong> | Operations Procedures</p>
            <p>Version 1.2.0 | Generated: January 2026 | Status: FINALIZED ‚úÖ</p>
            <p style="margin-top: 15px; opacity: 0.85; font-size: 0.95em;">Complete deployment procedures including pre-deployment checklist, staging deployment, blue-green production deployment, rollback procedures, scaling guidelines, and monitoring setup. Essential for operations and DevOps teams.</p>
            <p style="margin-top: 15px; opacity: 0.7; border-top: 1px solid rgba(255,255,255,0.2); padding-top: 15px; font-size: 0.9em;">¬© 2026 SwipeSavvy. All Rights Reserved. | <a href="SYSTEM_SNAPSHOT_INDEX.html" style="color: white;">Back to Index</a></p>
        </div>
    </footer>
</body>
</html>
